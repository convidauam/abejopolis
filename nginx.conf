server {
  listen 80;
  server_name _;

  root /usr/share/nginx/html;
  index index.html;
  charset utf-8;

  # Tipos MIME base
  types {
    application/wasm         wasm;
    application/javascript   js;
    application/octet-stream data;
    text/html                html;
    application/gzip         gz;
  }

  # Rutas generales
  location / {
    try_files $uri $uri/ /index.html =404;
  }

  # Sirve *.wasm.gz con Content-Encoding: gzip y Content-Type: application/wasm
  location ~* \.wasm\.gz$ {
    types { }                                  # limpia el mapa
    default_type application/wasm;
    add_header Content-Encoding gzip always;
    add_header Vary Accept-Encoding always;
    try_files $uri =404;
  }

  # Sirve *.data.gz con Content-Encoding: gzip y Content-Type: application/octet-stream
  location ~* \.data\.gz$ {
    types { }
    default_type application/octet-stream;
    add_header Content-Encoding gzip always;
    add_header Vary Accept-Encoding always;
    try_files $uri =404;
  }

  # Sirve *.js.gz con Content-Encoding: gzip y Content-Type: application/javascript
  location ~* \.js\.gz$ {
    types { }
    default_type application/javascript;
    add_header Content-Encoding gzip always;
    add_header Vary Accept-Encoding always;
    try_files $uri =404;
  }

  # (Si hubiera peticiones SIN .gz, permite usar versi√≥n .gz)
  location ~* \.wasm$ { default_type application/wasm;         try_files $uri $uri.gz =404; }
  location ~* \.data$ { default_type application/octet-stream; try_files $uri $uri.gz =404; }
  location ~* \.js$   { default_type application/javascript;   try_files $uri $uri.gz =404; }

  # COOP/COEP por si usas threads / SharedArrayBuffer
  add_header Cross-Origin-Opener-Policy same-origin always;
  add_header Cross-Origin-Embedder-Policy require-corp always;
}
